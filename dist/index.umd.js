!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).parseCrontab=n()}(this,(function(){"use strict";const e={1:{nameCn:"星期天",nameEn:"Sunday"},2:{nameCn:"星期一",nameEn:"Monday"},3:{nameCn:"星期二",nameEn:"Tuesday"},4:{nameCn:"星期三",nameEn:"Wednesday"},5:{nameCn:"星期四",nameEn:"Thursday"},6:{nameCn:"星期五",nameEn:"Friday"},7:{nameCn:"星期六",nameEn:"Saturday"}},n={"秒":/^([0-5]?[*0-9])$/,"分":/^([0-5]?[*0-9])$/,"时":/^([01]?[*0-9]|2[0-3])$/,"日":/^([*01-9]|[12][0-9]|3[01])$/,"月":/^([*0-9]|1[0-2])$/,"周":/^([*01-7])$/,"年":/^((19[7-9][0-9])|(20[0-9][0-9]))$/},t={"秒":/^([0-5]?[*0-9])#(\d+)$/,"分":/^([0-5]?[*0-9])#(\d+)$/,"时":/^([01]?[*0-9]|2[0-3])#(\d+)$/,"日":/^([*01-9]|[12][0-9]|3[01])#(\d)$/,"月":/^([*0-9]|1[0-2])#(\d+)$/,"周":/^([*01-7])#(\d+)$/,"年":/^((19[7-9][0-9])|(20[0-9][0-9]))#(\d+)$/},r={"秒":/^([0-5]?[*0-9])\/(\d+)$/,"分":/^([0-5]?[*0-9])\/(\d+)$/,"时":/^([01]?[*0-9]|2[0-3])\/(\d+)$/,"日":/^([*01-9]|[12][0-9]|3[01])\/(\d)$/,"月":/^([*0-9]|1[0-2])\/(\d+)$/,"周":/^([*01-7])\/(\d+)$/,"年":/^((19[7-9][0-9])|(20[0-9][0-9])|[0*])\/(\d+)$/},s={"秒":/^([0-5]?[*0-9])-(\d+)$/,"分":/^([0-5]?[*0-9])-(\d+)$/,"时":/^([01]?[*0-9]|2[0-3])-(\d+)$/,"日":/^([01-9]|[12][0-9]|3[01])-(\d)$/,"月":/^([0-9]|1[0-2])-(\d+)$/,"周":/^([*01-7])-(\d+)$/,"年":/^((19[7-9][0-9])|(20[0-9][0-9]))-((19[7-9][0-9])|(20[0-9][0-9]))$/},$={"秒":{range:60,unit:"秒"},"分":{range:60,unit:"分钟"},"时":{range:24,unit:"小时"}};function a(e,a,u){if(parseInt(e)<0)throw new Error("值域不能为负数");switch(!0){case/^\*$/.test(e):return`每${a}`;case/^\?$/.test(e):return"";case/^\d+#\d+$/.test(e):{const n=e.match(t[a]);if(n)return function(e,n){switch(n){case"秒":case"分":case"时":case"日":case"月":return`第${e[2]}个${e[1]}${n}`;case"周":return`第${e[2]}个${c(e[1])}`;case"年":return`第${e[0].split("#")[1]}个${e[0].split("#")[0]}${n}`;default:return""}}(n,a);throw new Error(`${a}${e}格式不正确`)}case/^(\d+,)+\d+$/.test(e):return function(e,n){function t(e){if(2===e.split(",").length)return`第${e.replace(/,/g,"和第")}${n}`;{const t=e.lastIndexOf(","),r=e.substring(t+1);return`第${e.substring(0,t).replace(/,/g,"、第")}和第${r}${n}`}}switch(n){case"秒":case"时":case"日":case"月":case"周":case"年":return t(e);case"分":return`${t(e)}钟`;default:return""}}(e,a);case/^[0-9]+-[0-9]+$/.test(e):if(e.match(s[a]))return function(e,n){const t=e.split("-"),[r,s]=t;switch(n){case"秒":case"分":case"时":case"日":case"月":case"年":return`${r}${n}到${s}${n}`;case"周":return`${n}${c(r)}到${c(s)}`;default:return""}}(e,a);throw new Error(`${a}${e}格式不正确`);case/^[*0-9]+\/[0-9]+$/.test(e):if(e.match(r[a])){if(["时","分","秒"].includes(a))return function(e,n){const t=e.split("/"),[r,s]=t,a=$[n].range+parseInt("*"===r?"0":r)-parseInt(s);return`,从${"*"===r?"0":r}${n}开始到${a}${$[n].unit}范围内每隔${s}${$[n].unit}`}(e,a);{const n=e.split("/"),[t,r]=n;return["0","*"].includes(t)?`每隔${r}${a}`:`从第${t}${a}开始，每隔${r}${a}`}}throw new Error(`${a}${e}格式不正确`);case/^\d*[Ll]$/.test(e):{const n=e.split("L"),[t]=n;return c(n[0])?`最后一${a}的${c(t)}`:`最后一${a}`}case/^\d+$/.test(e):if(e.match(n[a]))return function(e,n){switch(n){case"秒":case"分":case"时":case"日":case"月":case"年":return`${e}${n}`;case"周":return`每周${c(e)}`;default:return""}}(e,a);throw new Error(`${a}${e}格式不正确`);default:return""}}function c(n,t=!0){const r=Object.entries(e);for(let e=0;e<r.length;e++){const[s,$]=r[e];if(s===n)return t?$.nameCn:$.nameEn}}function u(e,n){return`${e}-${n}`}return function(e){return function(e,n){if(null===e||e.trim().length<1)throw new Error("cron表达式为空");let t=e.trim().split(" "),r="";if(6===t.length||7===t.length){if(t.every((e=>"*"===e)))return"每秒";if(7===t.length){r=a(t[6],n[6])}r=u(r,a(t[5],n[5]));r=u(r,a(t[4],n[4]));r=u(r,a(t[3],n[3]));r=u(r,a(t[2],n[2]));r=u(r,a(t[1],n[1]));return r=u(r,a(t[0],n[0])),r=function(e,n){let t=e.split("-");if(""!==t[2]&&""!==t[1]){let e=t[2];return t[2]=t[1],t[1]=e,t.reverse().slice(0,n.length).reverse().join("")}let r=n.findIndex((e=>"*"===e)),s=0;for(let e=r;e<t.length;e++)t[e]&&""!==t[e]&&(s+=1);return r>=0&&0===s?t.reverse().slice(0,n.length).slice(0,r+1).reverse().join(""):t.filter((e=>e.length)).join("")}(r,t),r.length?/^[每最第从\d]/.test(r)?r:/^[,]/.test(r)?r.substring(1):`每${r}`:r}throw new Error("crontab格式不正确")}(e,["秒","分","时","日","月","周","年"])}}));
